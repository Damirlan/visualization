# Визуализация: 5 лабораторных работ

Этот репозиторий содержит пять независимых программ (каждая как отдельная лабораторная работа) и общий набор зависимостей. Ниже — подробное описание по каждой программе: как она устроена, какие инструменты использованы, и какие алгоритмы реализованы.

## Общие требования и запуск

- Python 3.x
- Зависимости из `requirements.txt`

Установка зависимостей:

```bash
pip install -r requirements.txt
```

Запуск конкретной лабораторной работы:

```bash
python lab1.py
python desktop.py
python nn_training_animation.py
python car_dashboard.py
python primitive_game_ui.py
```

## Лабораторная работа 1: `lab1.py`

**Назначение:** аналитическая визуализация данных по продажам, возвратам и прибыли на основе Excel-файла.

**Входные данные:**
- Файл: `agg_202511011103.xlsx`
- Лист: `agg_202511011103`

**Инструменты:**
- `pandas` для загрузки Excel и агрегаций.
- `numpy` для расчетов и безопасного деления.
- `matplotlib` для построения графиков.

**Как разработано (логика шагов):**
1. Загружается Excel-файл и приводится колонка `month` к типу даты.
2. Месяцы переводятся в период `год-месяц` (`PeriodIndex`), чтобы корректно группировать данные.
3. Строится агрегация по месяцам: суммы продаж, возвратов, комиссий, логистики и прибыли.
4. Рассчитываются дополнительные показатели:
   - Количество заказов = продажи + возвраты + отмены.
   - Доля отмен и возвратов от общего числа заказов.
   - Маржа = прибыль / выручка.
   - Структура себестоимости (суммы по компонентам + остаток как `other_costs`).
5. Данные приводятся к формату, удобному для оси времени, и формируются подписи осей.

**Алгоритмы и визуализации:**
- Линейный график: продажи (шт) и чистая прибыль (руб) по месяцам с двумя осями (`twinx`).
- Линейный график: доля отмен и возвратов (в процентах).
- Стековый столбчатый график: структура себестоимости по месяцам.
- Scatter plot: зависимость средней цены от объема продаж для последних 3 месяцев.
- Горизонтальная диаграмма: топ-10 товаров по чистой прибыли.

**Особенности реализации:**
- Обработка делений на ноль через `replace([np.inf, -np.inf], np.nan)`.
- Использование русского шрифта `DejaVu Sans` для корректных подписей.

## Лабораторная работа 2: `desktop.py`

**Назначение:** интерактивное настольное приложение (desktop) для аналитики, построенное на Qt + matplotlib.

**Входные данные:**
- Те же данные, что и в ЛР1: `agg_202511011103.xlsx`, лист `agg_202511011103`.

**Инструменты:**
- `PyQt5` для интерфейса (окна, вкладки, элементы управления).
- `matplotlib` (встраивание через `FigureCanvasQTAgg`).
- `pandas`, `numpy` для агрегаций.

**Как разработано (архитектура):**
- Класс `MainWindow` управляет всеми вкладками и состоянием данных.
- Загруженные данные один раз агрегируются в `load_data()`.
- Для каждой вкладки создан отдельный метод `create_*_tab()`, а отрисовка вынесена в `update_*_plot()`.
- Используются контролы (чекбоксы, слайдеры, комбобоксы, спинбоксы), чтобы фильтровать и пересчитывать графики без перезапуска.

**Алгоритмы и вкладки:**
1. **Обзор:** продажи и прибыль по месяцам. Возможность включить/выключить линии через чекбоксы.
2. **Отмены/возвраты:** линии долей отмен и возвратов, аналогично ЛР1.
3. **Затраты:** стековая диаграмма структуры себестоимости.
4. **Scatter:** связь цены и продаж с фильтрацией по месяцу и минимальным продажам.
5. **Топ товаров:** горизонтальная диаграмма топ-N по прибыли, количество настраивается спинбоксом.
6. **Круговые диаграммы:**
   - структура затрат за выбранный месяц;
   - распределение прибыли по товарам за выбранный месяц.
7. **3D + анимация:** отдельная вкладка с 3D scatter (цена/продажи/прибыль по товарам) и накопительной анимацией продаж по месяцам (через `QTimer`).

**Особенности реализации:**
- Встроенный `NavigationToolbar` для каждого графика.
- Пересчет и обновление графиков происходит по событию изменения параметров UI.
- Используется `QTimer` для анимационных эффектов в соответствующей вкладке.

## Лабораторная работа 3: `nn_training_animation.py`

**Назначение:** визуальная демонстрация обучения многослойной нейросети с анимацией.

**Инструменты:**
- `numpy` для вычислений.
- `matplotlib` для отрисовки и анимации.
- `sklearn.datasets` для генерации синтетических данных (`moons`, `circles`, `blobs`).

**Как разработано (структура):**
- Класс `MultiLayerNN` реализует прямой и обратный проход.
- Используются веса с инициализацией Ксавье.
- Визуализация включает три зоны:
  - схема сети с весами и активациями,
  - датасет и решающая граница,
  - график функции потерь.
- Управление анимацией через `matplotlib.animation.FuncAnimation`.
- Добавлены кнопки Play/Pause, слайдер скорости и переключатель датасета.

**Алгоритмы:**
- Архитектура сети: список размеров слоев `LAYER_SIZES = [2, 4, 4, 3, 1]`.
- Активации:
  - скрытые слои: `tanh`,
  - выход: `sigmoid` (для бинарной классификации).
- Функция потерь: бинарная кросс-энтропия (BCE).
- Обучение: SGD по одному объекту (online learning).
- Визуализация весов:
  - цвет линии зависит от знака веса,
  - толщина линии — от модуля веса.

**Особенности реализации:**
- Анимация происходит по фазам: сначала новый шаг обучения, затем визуальный “проход” по слоям.
- Решающая граница строится через прогноз на сетке (`meshgrid`).
- Можно в реальном времени переключать датасет и скорость.

## Лабораторная работа 4: `car_dashboard.py`

**Назначение:** имитация автомобильной приборной панели с аналоговыми шкалами и цифровыми индикаторами.

**Инструменты:**
- `PyQt5` для окна, таймера и графики.
- `QPainter` для отрисовки шкал.
- `QTimer` для обновления значений в реальном времени.

**Как разработано (структура):**
- Класс `GaugeWidget` рисует одну шкалу (скорость или обороты).
- Отрисовка реализована в `paintEvent()`:
  - окружность шкалы,
  - основная дуга,
  - деления и подписи,
  - стрелка.
- Главный класс `DashboardWindow` собирает интерфейс из двух шкал, LCD-дисплеев и кнопки «Газ».

**Алгоритмы:**
- Преобразование значения в угол: линейное отображение `[min_value, max_value]` в диапазон углов.
- Отрисовка делений:
  - крупные деления с подписями,
  - мелкие деления для детализации.
- Логика изменения скорости и оборотов:
  - при нажатии «Газ» скорость растет,
  - при отпускании — плавно падает,
  - обороты вычисляются как функция скорости + буст при ускорении.

**Особенности реализации:**
- Визуализация выполнена полностью вручную через `QPainter`.
- `QTimer` с интервалом 30 мс обеспечивает плавность обновления.

## Лабораторная работа 5: `primitive_game_ui.py`

**Назначение:** стилизованный игровой интерфейс (мини-RPG), где пользователь атакует противника, управляет энергией и лечением.

**Инструменты:**
- `PyQt5` для оконного интерфейса.
- `QPainter` и `QPropertyAnimation` для анимированных прогресс-баров.
- `QTimer` для игровых “тиков” и кулдаунов.
- `QPixmap` для отображения изображения противника (`images.jpeg`).

**Как разработано (структура):**
- `AnimatedBar` рисует плавно анимируемую шкалу (HP, энергия, XP, здоровье врага).
- `EnemyImage` обрабатывает клики по картинке и инициирует атаку.
- `GameWindow` управляет состоянием игры, логикой кнопок и обновлением интерфейса.
- Применены стили QSS для “неонового” визуального оформления.

**Алгоритмы и игровые правила:**
- Атака:
  - обычный удар тратит 10 энергии, наносит случайный урон 8–18.
  - специальная атака тратит 25 энергии, урон 20–34.
- Отдых:
  - восстанавливает энергию и часть здоровья.
- Восстановление (heal):
  - лечит на 25 HP, имеет кулдаун (таймер 8 сек).
- Противник атакует с вероятностью 55% каждые 1.2 секунды.
- После победы над противником:
  - увеличивается максимальное здоровье, энергия и сложность;
  - начисляются опыт и кредиты.

**Особенности реализации:**
- Шкалы используют `QPropertyAnimation` для плавной анимации значений.
- Таймеры разделены по логике: пассивное восстановление, атака врага, кулдаун лечения.
- Статус и лог обновляются в реальном времени.

## Файлы проекта

- `lab1.py` — лабораторная работа 1 (статическая аналитика).
- `desktop.py` — лабораторная работа 2 (desktop интерфейс).
- `nn_training_animation.py` — лабораторная работа 3 (анимация нейросети).
- `car_dashboard.py` — лабораторная работа 4 (приборная панель).
- `primitive_game_ui.py` — лабораторная работа 5 (игровой UI).
- `agg_202511011103.xlsx` — входные данные для ЛР1 и ЛР2.
- `images.jpeg` — изображение противника для ЛР5.
- `requirements.txt` — список зависимостей.
